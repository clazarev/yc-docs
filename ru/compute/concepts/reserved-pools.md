---
title: Пулы резервов ВМ {{ compute-full-name }}
description: Из статьи вы узнаете, что такое пул резервов ВМ и как резервировать необходимые вычислительные ресурсы для создания ВМ нужных конфигураций в нужных зонах доступности.
---

# Пулы резервов виртуальных машин

{% include [reserved-pools-pricing-warning](../../_includes/compute/reserved-pools-pricing-warning.md) %}

{% include [reserved-pools-preview-notice](../../_includes/compute/reserved-pools-preview-notice.md) %}

_Пул резервов виртуальных машин_ — это зарезервированная пользователем в заданной [зоне доступности](../../overview/concepts/geo-scope.md) совокупность вычислительных ресурсов, которые будут гарантированно доступны пользователю для создания в этой зоне доступности [виртуальных машин](./vm.md) в определенной [конфигурации](./performance-levels#available-configurations).

Управлять пулами резервов ВМ и привязкой к ним виртуальных машин вы можете с помощью [{{ yandex-cloud }} CLI](../cli-ref/reserved-instance-pool/index.md) и [API](../api-ref/ReservedInstancePool/index.md).

Пулы резервов ВМ несовместимы с [выделенными хостами](./dedicated-host.md), [прерываемыми ВМ](./preemptible-vm.md) и виртуальными машинами с [уровнем производительности vCPU](./performance-levels.md) менее 100%. Кроме того, в настоящее время пулы резервов ВМ не поддерживают [группы размещения](./placement-groups.md) и [группы виртуальных машин](./instance-groups/index.md).

Пул резервов ВМ состоит из набора _слотов_ — совокупностей [вычислительных ресурсов](./vm.md#types) в зоне доступности, минимально необходимых для запуска одной виртуальной машины в заданной для пула конфигурации.

## Размер пула {#pool-size}

Размер пула резервов ВМ — это количество слотов, из которых состоит пул. Размер пула указывается в поле `size` в [сведениях](#stats) о пуле.

При изменении размера пула с [опцией ожидания ресурсов](#pending-slots) в дополнение к размеру пула, заданному значением поля `size`, ключевым параметром также является размер, заданный значением поля `committed_size`. Поле `committed_size` содержит информацию о фактическом количестве слотов пула, не находящихся в режиме ожидания ресурсов, то есть о количестве слотов, для которых сервис {{ compute-name }} гарантирует наличие ресурсов.

Значение поля `committed_size` отличается от значения поля `size` только в тех случаях, когда в пуле есть слоты, [ожидающие ресурсов](#pending-slots). Если опция ожидания ресурсов не используется, значения полей `size` и `committed_size` идентичны.

Каждая запущенная виртуальная машина, привязанная к пулу резервов ВМ, [занимает](#slot-stats) один слот. Привязанные к пулу и не запущенные виртуальные машины не занимают слоты пула, но при этом учитываются в [статистике](#vm-stats) пула по виртуальным машинам.

Если для пула не включена [переподписка](#oversubscription), к нему нельзя привязать виртуальных машин больше, чем задано в поле `committed_size`. Если переподписка включена, то количество привязанных к пулу ВМ может превысить размер `committed_size` этого пула.

Независимо от статуса переподписки в пуле резервов ВМ, нельзя одновременно запустить больше виртуальных машин, чем указано в поле `committed_size`.

### Опция ожидания ресурсов {#pending-slots}

При увеличении размера пула вы можете включить опцию _ожидания ресурсов_. Эта опция позволяет увеличить размер пула на нужное количество слотов, даже в тех случаях, когда в момент расширения пула в его зоне доступности нет достаточного количества свободных ресурсов.

Опция задается в параметре `--allow-pending-slots` [команды](../cli-ref/reserved-instance-pool/update.md) {{ yandex-cloud }} CLI `yc compute reserved-instance-pool update` или в поле `allow_pending_slots` запроса [API](../api-ref/ReservedInstancePool/index.md).

При использовании этой опции слоты, на которые при расширении пула не хватило ресурсов, переходят в [статус](#slot-stats) ожидания ресурсов (`pending`). В дальнейшем для слотов в статусе `pending` сервис автоматически и непрерывно пытается найти доступные ресурсы в зоне доступности пула резервов ВМ. Как только нужные ресурсы для слота найдены, слот переходит в статус `available`, а значение поля `committed_size` в пуле увеличивается.

{% note info %}

Слоты в статусе ожидания ресурсов (`pending`) не тарифицируются.

{% endnote %}

Опцию ожидания ресурсов необходимо включать при любом изменении размера пула, который уже содержит слоты в статусе `pending`. В противном случае операция изменения пула резервов ВМ завершится ошибкой. Исключение — операция уменьшения размера пула до значения, не превышающего текущего значения поля `committed_size`. При уменьшении размера пула из него в первую очередь удаляются слоты в статусе `pending`.

## Создание пула {#creating-pool}

При [создании](../operations/reserved-pools/create-reserved-pool.md) пула резервов ВМ для него задаются размер в слотах, зона доступности, в которой будут резервироваться вычислительные ресурсы, и конфигурация виртуальных машин, входящих в пул.

Конфигурация виртуальных машин пула включает в себя следующие параметры:

* [платформа](./vm-platforms.md);
* количество [vCPU](./performance-levels.md);
* объем памяти (RAM);
* кластер и количество [GPU](./gpus.md);
* тип сети (обычная или [программно-ускоренная](./software-accelerated-network.md)).

Вы можете [изменить](../operations/reserved-pools/update-reserved-pool.md) размер пула после его создания. Зона доступности и конфигурация ВМ задаются только при создании пула и не могут быть изменены позднее.

## Управление виртуальными машинами пула {#managing-pool}

{% note info %}

К пулу резервов ВМ нельзя привязать виртуальную машину с конфигурацией, отличной от конфигурации, которая задана в настройках пула.

{% endnote %}

### Привязка виртуальных машин к пулу {#attaching-vms}

Чтобы привязать виртуальную машину к пулу резервов ВМ, передайте в ее настройки идентификатор нужного пула. Вы можете привязать виртуальную машину к пулу резервов ВМ как при [создании](../operations/reserved-pools/manage-pool-vms.md#attach-new-vm) новой ВМ, так и при [изменении](../operations/reserved-pools/manage-pool-vms.md#attach-existing-vm) существующей.

При создании новой виртуальной машины в пуле резервов ВМ эта виртуальная машина займет один из [свободных](#stats) слотов пула. При этом, если при создании новой ВМ в этом пуле нет свободных слотов, то создание ВМ завершится ошибкой. Чтобы это исправить, вы можете [увеличить](../operations/reserved-pools/update-reserved-pool.md) размер пула.

При привязке к пулу резервов ВМ существующей виртуальной машины:
* если привязываемая ВМ остановлена, то в [статистике](#vm-stats) по виртуальным машинам пула увеличится значение поля `total`;
* если привязываемая ВМ запущена, то в [статистике по слотам](#slot-stats) пула уменьшится количество слотов в статусе `available`, увеличится количество слотов в статусе `used`, а также увеличится значение поля `total` в [статистике по виртуальным машинам](#vm-stats).

    Если в пуле есть слоты в статусе `pending` или `unavailable`, то при привязке к пулу запущенных ВМ замещаться будут именно такие слоты, причем слоты `unavailable` будут замещаться в первую очередь.

По умолчанию к пулу можно привязать количество виртуальных машин, не превышающее текущий фактический размер пула (значение поля `committed_size`). Такое поведение можно изменить с помощью опции [переподписки](#oversubscription).

#### Переподписка {#oversubscription}

В _режиме переподписки_ вы можете привязывать к пулу любое количество остановленных виртуальных машин, поэтому количество привязанных к пулу ВМ может превышать размер пула. При этом количество одновременно запущенных виртуальных машин пула не может превысить его текущий фактический размер (значение поля `committed_size`), а попытка запустить привязанную к пулу виртуальную машину при отсутствии слотов в [статусе](#slot-stats) `available` завершится ошибкой.

Включить режим переподписки можно при создании или изменении пула резервов ВМ с помощью параметра `--allow-oversubscription` в [командах](../cli-ref/reserved-instance-pool/index.md) {{ yandex-cloud }} CLI `yc compute reserved-instance-pool create|update` или в поле `allow_oversubscription` запроса [API](../api-ref/ReservedInstancePool/index.md).

Чтобы отключить для пула режим переподписки, убедитесь, что число привязанных к нему виртуальных машин не превышает его текущий фактический размер (значение поля `committed_size`). При необходимости предварительно [отвяжите](../operations/reserved-pools/manage-pool-vms.md#detach-vm) от пула все лишние виртуальные машины.

### Запуск и остановка виртуальных машин, привязанных к пулу {#stopping-vms}

Остановка виртуальной машины, привязанной к пулу резервов ВМ, освобождает занимаемый этой виртуальной машиной слот, переводя его в [статус](#slot-stats) `available`. Высвободившийся слот может быть использован этой же или другой виртуальной машиной пула. Таким образом, остановленные ВМ не расходуют слоты пула резервов ВМ.

При повторном запуске эта ВМ вновь займет один из доступных слотов, переведя его в статус `used`.

### Отвязка виртуальных машин от пула {#detaching-vms}

Вы можете [отвязать](../operations/reserved-pools/manage-pool-vms.md#detach-vm) виртуальную машину от пула резервов ВМ: 
* если отвязываемая ВМ остановлена, то в [статистике по виртуальным машинам](#vm-stats) пула уменьшится значение поля `total`;
* если отвязываемая ВМ запущена, то в [статистике](#slot-stats) по слотам пула увеличится количество слотов в статусе `available`, уменьшится количество слотов в статусе `used`, а также уменьшится значение поля `total` в статистике [по виртуальным машинам](#vm-stats).

    Отвязать от пула запущенную виртуальную машину возможно только в том случае, если в зоне доступности есть свободные ресурсы, которые можно зарезервировать под освобождающийся в пуле слот.

    {% note info %}

    При отвязывании запущенной ВМ от пула резервов ВМ объем [тарифицируемых](../pricing.md) ресурсов увеличивается: отвязанная ВМ продолжает тарифицироваться отдельно от пула, а в пуле появляется новый слот в статусе `available`, зарезервированные ресурсы для которого также тарифицируются.

    {% endnote %}


## Статистика использования ресурсов пула {#stats}

Сведения о пуле резервов ВМ вы можете получить с помощью [команды](../cli-ref/reserved-instance-pool/get.md) {{ yandex-cloud }} CLI `yc compute reserved-instance-pool get`, метода REST API [get](../api-ref/ReservedInstancePool/get.md) для ресурса [ReservedInstancePool](../api-ref/ReservedInstancePool/index.md) или вызова gRPC API [ReservedInstancePoolService/Get](../api-ref/grpc/ReservedInstancePool/get.md). Полученные сведения содержат имя, идентификатор, размер, зону доступности, конфигурацию ВМ пула, статистику по слотам и виртуальным машинам пула, а также другие параметры.

### Статистика по слотам пула {#slot-stats}

Статистика по слотам пула резервов ВМ содержит следующие поля:

* `total` — общее количество слотов в пуле. Равно сумме количеств всех слотов в статусах `used`, `available`, `unavailable` и `pending`.
* `used` — количество слотов, занятых запущенными виртуальными машинами.
* `available` — количество слотов, для которых в зоне доступности пула зарезервированы ресурсы и которые доступны для использования виртуальными машинами.

    Слоты пула резервов ВМ в статусе `available` расходуют [квоты](./limits.md#compute-quotas) на суммарное количество vCPU, GPU и суммарный объем виртуальной памяти ВМ, но не расходуют квоты на количество виртуальных машин в одном облаке.
* `unavailable` — количество слотов, недоступных по техническим причинам.

    Слот может перейти в статус `unavailable`, если, например, часть зарезервированного под пул оборудования вышла из строя. Слот в таком статусе невозможно использовать для запуска ВМ.
    
    Сервис автоматически и непрерывно пытается восстанавливать слоты в статусе `unavailable` за счет имеющихся в зоне доступности ресурсов. Как только необходимые для замещения ресурсы найдены, слот возвращается в статус `available`.
* `pending` — количество слотов, находящихся в [ожидании](#pending-slots) необходимых ресурсов.

    Этот статус присваивается добавляемому в пул слоту, когда при увеличении размера пула в зоне доступности отсутствуют необходимые для этого нового слота ресурсы, но при этом для операции обновления пула включена опция ожидания ресурсов.

    Сервис автоматически и непрерывно пытается найти доступные ресурсы для слотов, находящихся в статусе `pending`. Как только нужные ресурсы для слота найдены, слот переходит в статус `available`.

{% note info %}

Слоты в статусах `unavailable` и `pending` не тарифицируются.

{% endnote %}

### Статистика по виртуальным машинам пула {#vm-stats}

Статистика по виртуальным машинам пула резервов ВМ содержит поле `total` с информацией об общем количестве виртуальных машин, привязанных к пулу. В значении этого поля учитываются все привязанные к пулу виртуальные машины: как запущенные, так и остановленные.

## Удаление пула {#deleting-pool}

При [удалении](../operations/reserved-pools/delete-reserved-pool.md) пула резервов ВМ все привязанные к пулу виртуальные машины будут от него отвязаны, а запущенные ВМ продолжат работать.

#### См. также {#see-also}

* [{#T}](../operations/reserved-pools/create-reserved-pool.md)
* [{#T}](../operations/reserved-pools/update-reserved-pool.md)
* [{#T}](../operations/reserved-pools/delete-reserved-pool.md)
* [{#T}](../operations/reserved-pools/manage-pool-vms.md)