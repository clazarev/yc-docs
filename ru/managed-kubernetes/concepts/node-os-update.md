# Обновление операционной системы в группе узлов

Начиная с версии {{ k8s }} 1.30 операционная система узлов изменилась с Ubuntu 20.04 на Ubuntu 22.04. При [обновлении групп узлов](../operations/node-group/node-group-update.md) в этих версиях новые узлы автоматически создаются из [образа](../../compute/concepts/image.md) [виртуальной машины](../../compute/concepts/vm.md) с Ubuntu 22.04.

{% note info %}

Обновление версии ОС доступно в [релизном канале](release-channels-and-updates.md) `RAPID`. Позже обновление станет доступно в релизных каналах `REGULAR` и `STABLE`.

{% endnote %}

## Изменения пользовательских ресурсов {#user-resources-update}

В Ubuntu 22.04 изменились системные библиотеки и заголовки ядра Linux, поэтому компиляция драйверов GPU может не работать для групп узлов с пользовательскими драйверами GPU.

Как это проявляется:

* Возникают ошибки сборки драйвера.
* Не обнаруживается GPU.
* Обновление группы узлов завершается неуспешно.

Чтобы этого избежать, при подготовке к обновлению обеспечьте совместимость версий GPU Operator и драйверов:

* Обновите GPU Operator до версии `24.9.x+`.
* Обновите драйвер до версии `550.144.03` или выше.
* Используйте предварительно скомпилированные драйверы. Для этого при установке GPU Operator задайте настройку `--driver.usePrecompiled=true`.

Подробнее об использовании GPU с пользовательской версией драйвера см. в разделе [{#T}](../tutorials/driverless-gpu.md).

{% note warning %}

Так как в Ubuntu 22.04 используется новая версия ядра Linux 5.15, обновление ОС может нарушить работу пользовательских модулей ядра, компилируемых с помощью [DKMS](https://github.com/dkms-project/dkms).

{% endnote %}

## Подготовка к миграции {#prepare-to-migration}

Перед миграцией кластера {{ k8s }} на новую версию ОС протестируйте обновление на новом кластере:

1. [Создайте кластер {{ managed-k8s-name }}](../operations/kubernetes-cluster/kubernetes-cluster-create.md) и укажите для него релизный канал `RAPID`.
1. [Создайте группу узлов](../operations/node-group/node-group-create.md) в созданном кластере.
1. Протестируйте работу ваших приложений, у которых могут быть зависимости от версии ОС, в созданном кластере.

   Проверьте ключевые показатели нагрузки:

   * загрузка GPU;
   * мониторинг состояния приложений;
   * функционирование агентов мониторинга и драйверов.

## Как проверить версию ОС на узлах {#how-to-check-os}

Все узлы в группе используют один и тот же базовый образ версии ОС. Проверить версию ОС можно с помощью команд:

```bash
kubectl get nodes -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.status.nodeInfo.osImage}{"\n"}{end}'
```

```bash
kubectl get node <node-name> -o jsonpath='{.status.nodeInfo.osImage}{"\n"}'
```
