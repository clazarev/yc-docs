# Данные для {{ brand-voice-lite-name }}

{{ brand-voice-lite-name }} позволяет создать свой уникальный голос на основе минимума размеченных аудиозаписей. В результате вы получите идентификатор модели, к которой сможете обращаться из своих приложений через API.


## Какие данные нужны для обучения {#data}

Чтобы создать свой голос {{ brand-voice-lite-name }}, необходимо подготовить _датасет_ для обучения — аудиозаписи и соответствующие им тексты. Каждая аудиозапись должна точно соответствовать приведенному тексту.

Объем данных для обучения модели зависит от особенностей дикции диктора и назначения создаваемого голоса. Так, голос для озвучки художественной литературы потребует больше данных, чем голос для голосового робота. Минимальный объем чистого аудио без учета тишины в начале и конце каждого файла — 30 минут, рекомендуемый — 60 минут, хороший — 90 минут и более. Для создания голоса с несколькими [амплуа](../index.md#role) понадобится отдельно записать датасет для каждого.

{% note tip %}

Результат обучения голосовой модели {{ brand-voice-lite-name }} напрямую зависит от обучающих данных. Чтобы получить качественный голос {{ brand-voice-lite-name }}, выполняйте все приведенные рекомендации для текстов и аудиозаписей.

{% endnote %}

Как минимум 30% обучающих данных должны содержать вопросы, чтобы обученный голос мог синтезировать вопросительную интонацию в тексте. Вы можете использовать уже готовый [набор фраз](https://storage.yandexcloud.net/doc-files/ml/brand_voice_lite_text_example-txt.zip) от команды {{ speechkit-name }} или самостоятельно подготовить тексты для озвучивания. Рекомендации по созданию и оформлению текстов для обучения см. в разделе [Требования к текстам](#text-technical-requirements).

Независимо от того, записываете вы готовый набор фраз или подготавливаете свои данные, обязательно включите в обучающий датасет следующую фразу: `Я даю согласие на использование своего голоса в сервисе Спичкит`.

Вы можете загрузить датасет со всеми аудиозаписями и расшифровками [в виде одного архива](#zip), загрузить аудиофайлы по одному или записать аудио для каждой фразы [в консоли управления](#console-record) через браузер. В любом случае обязательно следуйте [рекомендациям для записи аудио](#audiotips) и прослушайте все аудио, чтобы убедиться в качестве исходных данных для обучения голосовой модели. После запуска обучения исправить датасет не получится. 

## Требования к текстам {#text-technical-requirements}

Команда {{ speechkit-name }} предоставляет уже готовый набор текстов, которые вам необходимо только озвучить. Он содержит повествовательные, вопросительные и восклицательные фразы и подойдет в большинстве случаев для создания русскоязычных голосов. Также вы можете самостоятельно подготовить тексты для записи аудио, однако убедитесь, что они соответствуют следующим требованиям:

* Тексты не должны содержать грамматических ошибок.
* Рекомендуемая длина фразы — не более {{ tts-v3-count }}.
* Все фразы должны быть полными, без обрывов на полуслове.
  > "..ть Время! Разве такое ему может понравиться! Если б ты с ним не ссорилась, могла бы просить у него все, что хо."

{% include [text requirements](../../../_includes/speechkit/tts-text-requirements.md) %}

## Рекомендации для записи аудио {#audiotips}

Записывайте аудио в тихой комнате без посторонних шумов. Звук вентилятора, кондиционера или холодильника, шум улицы, фоновая музыка и эхо будут слышны на записи и сильно отразятся на качестве создаваемого голоса. Идеальным местом будет комната, оборудованная акустическими панелями. Если вы записываете свой голос в бытовых условиях, снизить эхо помогут мягкие поверхности и мебель: ковер, мягкий диван и т. д.

Для записи аудио не обязательно использовать профессиональное оборудование. Если у вас нет студийного микрофона, используйте встроенный микрофон ноутбука, смартфон или гарнитуру. Режим шумоподавления в большинстве гарнитур обрезает начало и конец фразы, поэтому рекомендуем отключить его. Не меняйте настройки аппаратуры до окончания записи. Расстояние до микрофона должно быть одинаковым для всех аудио.

На время записи отключите используемое устройство от электросети, если это возможно: в процессе зарядки аккумулятора могут возникать аудиопомехи. Также отключите звуковые уведомления и переведите смартфон в авиарежим, чтобы посторонние звуки не попали на запись.

Записывайте аудио с максимально возможным качеством без сжатия. Если для записи вы используете специальные программы, убедитесь, что сжатие файлов и дополнительные фильтры отключены.

Перед записью убедитесь, что вы не голодны и не испытываете жажду, нет лишнего слюноотделения или сухости во рту. Уберите шуршащие предметы и постарайтесь лишний раз не двигать руками и ногами во время записи. Расслабьтесь, выпрямите спину и шею, дышите глубоко и свободно. Звуки вашего дыхания не должны перекрывать аудио на записи.

Читайте текст так, чтобы он звучал максимально естественно и органично. Эмоции должны соответствовать произносимому тексту. Сохраняйте интонацию при записи всех примеров для одного амплуа. Подробные рекомендации о записи амплуа см. в разделе [{#T}](./roles-records.md).

Если вы ошиблись в произношении, перезапишите всю фразу, а не пытайтесь исправиться в том же аудио. Неточности, микроповторы, оговорки и замены слов недопустимы. Любые дефекты дикции в записях, на основе которых работает модель синтеза, значительно снижают качество синтезируемой речи.

После записи фразы прослушайте получившееся аудио. Убедитесь, что все слова произнесены четко и внятно, в начале и в конце аудио есть небольшие отрезки тишины, на фоне нет посторонних звуков.

### Требования к аудиозаписям {#requirements-audio}

Если вы записываете аудио с помощью специальных программ, а не в консоли управления через браузер, убедитесь, что они соответствуют следующим требованиям:

| Требование | Значение |
| --- | --- |
| Частота дискретизации | 48 кГц |
| Глубина аудио (audio bit depth) |  16 бит PCM |
| Количество каналов | 1 (моно) |
| Формат | [WAV](https://ru.wikipedia.org/wiki/WAV) |
| Продолжительность | ≤ 15 секунд |
| Тишина в начале и в конце | 100–200 миллисекунд |

{% note warning %}

В каждой аудиозаписи должна быть полностью произнесенная фраза из одного или нескольких предложений длительностью не более 15 секунд. Текстовая расшифровка в таблице должна полностью совпадать с текстом на аудиозаписи.

{% endnote %}

В каждой аудиозаписи в начале и в конце должны присутствовать интервалы тишины, обрезанные звуки и слова недопустимы. Нельзя взять аудиозапись подкаста и нарезать ее на отрезки по 15 секунд: в этом случае границы аудиозаписей будут попадать на середину слова или фразы и не будут соответствовать логическим фразам. Обучить качественную модель на таких данных не получится.

> Пример правильно подготовленной аудиозаписи: в начале и в конце аудио есть несколько миллисекунд тишины, фраза произнесена полностью.

![good-audio](../../../_assets/speechkit/good-audio.png)

> Пример плохой аудиозаписи: в начале и в конце аудио нет интервалов тишины, начало и конец фразы обрезаны.

![bad-audio](../../../_assets/speechkit/bad-audio.png)

Такие аудиозаписи будут иметь искажения и не подойдут для обучения модели.

## Как создать голос {#create-voice}

{% list tabs group=instructions %}

- Записать аудио через браузер {#record}

  1. В [консоли управления]({{ link-console-main }}) выберите [каталог](../../../resource-manager/concepts/resources-hierarchy.md#folder), в котором вы будете работать с сервисом.
  1. В списке сервисов выберите **{{ ui-key.yacloud.iam.folder.dashboard.label_speechkit }}**.
  1. На панели слева нажмите **{{ ui-key.yacloud.speechkit-common.brand-voice_51nd8 }}**.
  1. Нажмите **{{ ui-key.yacloud.speechkit-common.button_create-voice_nkMBz }}**.
  1. Нажмите **{{ ui-key.yacloud.speechkit-common.button_create-dataset_nLanW }}** и выберите **{{ ui-key.yacloud.speechkit-common.brand-voice_create-dataset_option_title_record-audio_jvUMz }}**.
  1. Выберите данные для записи: нажмите **Использовать готовый шаблон** или **Загрузить собственные тексты**.
  1. В строке с нужным текстом нажмите **Записать аудио** ⟶ **Записать**, а затем прочитайте текст вслух.
  1. Нажмите кнопку ![circle-play](../../../_assets/console-icons/circle-play.svg), чтобы прослушать результат.
  1. Если запись не содержит посторонних звуков, фраза записана полностью, и ее хорошо слышно, нажмите ![floppy-disk](../../../_assets/console-icons/floppy-disk.svg) **Сохранить**. Чтобы повторить запись, нажмите ![arrow-rotate-left](../../../_assets/console-icons/arrow-rotate-left.svg) **Записать заново**.
  1. Запишите аудио для остальных текстов.  
  1. {% include [voice-usage-policy-2](../../../_includes/speechkit/voice-usage-policy.md) %}
  1. Нажмите **{{ ui-key.yacloud.speechkit-common.button_create-voice_nkMBz }}**, чтобы запустить создание голоса.

- Загрузить аудиофайлы {#audio}

  1. В [консоли управления]({{ link-console-main }}) выберите [каталог](../../../resource-manager/concepts/resources-hierarchy.md#folder), в котором вы будете работать с сервисом.
  1. В списке сервисов выберите **{{ ui-key.yacloud.iam.folder.dashboard.label_speechkit }}**.
  1. На панели слева нажмите **{{ ui-key.yacloud.speechkit-common.brand-voice_51nd8 }}**.
  1. Нажмите **{{ ui-key.yacloud.speechkit-common.button_create-voice_nkMBz }}**.
  1. Нажмите **{{ ui-key.yacloud.speechkit-common.button_create-dataset_nLanW }}** и выберите **{{ ui-key.yacloud.speechkit-common.brand-voice_create-dataset_option_title_upload-audio_4D15S }}**.
  1. Выберите тексты, по которым записывались аудиофайлы: нажмите **Использовать готовый шаблон** или **Загрузить собственные тексты**.
  1. В строке с нужным текстом нажмите **Добавить аудиофайл**.
  1. Добавьте аудиофайлы для остальных текстов.
  1. {% include [voice-usage-policy-1](../../../_includes/speechkit/voice-usage-policy.md) %}
  1. Нажмите **{{ ui-key.yacloud.speechkit-common.button_create-voice_nkMBz }}**, чтобы запустить создание голоса.

- Загрузить ZIP-архив {#zip}

  1. В [консоли управления]({{ link-console-main }}) выберите [каталог](../../../resource-manager/concepts/resources-hierarchy.md#folder), в котором вы будете работать с сервисом.
  1. В списке сервисов выберите **{{ ui-key.yacloud.iam.folder.dashboard.label_speechkit }}**.
  1. Нажмите **{{ ui-key.yacloud.speechkit-common.button_create-voice_nkMBz }}**.
  1. Нажмите **{{ ui-key.yacloud.speechkit-common.button_create-dataset_nLanW }}** и выберите **{{ ui-key.yacloud.speechkit-common.brand-voice_create-dataset_option_title_upload-zip_nFtBR }}**.
  1. Перетащите ZIP-архив в область загрузки.
  
     ZIP-архив с датасетом для дообучения должен содержать:
     
     * Аудиозаписи в формате WAV.
     * Таблицу в формате [TSV](https://ru.wikipedia.org/wiki/TSV) в кодировке UTF-8, содержащей текстовые расшифровки аудиозаписей из архива. Таблица должна состоять из двух колонок без заголовков:
        * имя файла с аудиозаписью, на которой диктор произносит текст;
        * строка, содержащая дословную расшифровку аудиозаписи.
  
  1. {% include [voice-usage-policy](../../../_includes/speechkit/voice-usage-policy.md) %}

  1. Нажмите **{{ ui-key.yacloud.speechkit-common.button_create-voice_nkMBz }}**, чтобы запустить создание голоса.
  
  Если вы используете [шаблон](https://storage.yandexcloud.net/doc-files/ml/brand_voice_lite_text_example-tsv.zip) от команды {{ speechkit-name }}, в начало каждой строки добавьте название файла с соответствующей аудиозаписью и удалите строку с заголовком таблицы.

  **Пример подготовленных данных**

  Заголовок таблицы приведен для наглядности, в файле для загрузки он должен отсутствовать.

  | recordings | text |
  |---|---|
  | 1.wav | Книги собирают жемчужины человеческой мысли и передают их потомкам. |
  | 2.wav | Мы предлагаем вам замечательную книгу! |
  | 3.wav | Книга рекомендована школьникам от пяти лет. |

{% endlist %}

## Статусы голоса {#statuses}

Как только вы запустите создание голоса, он появится в списке доступных голосов в разделе **{{ ui-key.yacloud.speechkit-common.brand-voice_51nd8 }}**. Процесс создания займет несколько дней, в это время голос будет находиться в статусе `Creating`. Когда процесс будет завершен и голос станет доступным для тестирования, статус изменится на `Trial`. В течение 7 дней вы можете использовать голос бесплатно в {{ speechkit-name }} Playground и синтезировать речь по API, оплачивая только сами запросы (см. [правила тарификации](../../pricing.md)). Когда пробный период истечет, голос будет перенесен в архив, получит статус `Archived`, и вы не сможете использовать его. Хостинг архивных голосов не тарифицируется.

Если созданный голос вас устраивает, вы можете его активировать, не дожидаясь завершения пробного периода. Также вы можете активировать голос, находящийся в архиве:

1. В [консоли управления]({{ link-console-main }}) выберите [каталог](../../../resource-manager/concepts/resources-hierarchy.md#folder), в котором вы будете работать с сервисом.
1. В списке сервисов выберите **{{ ui-key.yacloud.iam.folder.dashboard.label_speechkit }}**.
1. На панели слева нажмите **{{ ui-key.yacloud.speechkit-common.brand-voice_51nd8 }}**.
1. Выберите голос и перейдите на его страницу.
1. В правом верхнем углу нажмите **{{ ui-key.yacloud.speechkit-common.brand-voice_button_activate_47zAB }}**. 
   После активации голос получит статус `Active` и станет доступен через API и в {{ speechkit-name }} Playground без ограничений. Начнется тарификация хостинга. 

Если голос вам больше не нужен, вы можете переместить его в архив.

## Как обратиться к голосу в дообученной модели {#request-voice}

Созданный голос будет доступен в {{ speechkit-name }} Playground и через [API v3](../../tts/api/tts-v3-rest.md). Чтобы использовать голос через API, укажите полученный идентификатор модели в настройках параметров синтеза:

{% list tabs group=instructions %}

- API {#api}

  ```json
  {
  ...
  "model": "tts://<идентификатор_каталога>/bvss-v1/latest@<идентификатор_голоса>/?<идентификатор_модели>"
  ...
  }
  ```

{% endlist %}

**Пример**

Используйте [IAM-токен](../../../iam/concepts/authorization/iam-token.md) для аутентификации от имени [аккаунта на Яндексе](../../../iam/operations/iam-token/create.md) или [федеративного аккаунта](../../../iam/operations/iam-token/create-for-federation.md). У аккаунта должна быть [роль](../../security/index.md#ai-speechkit-tts-user) `{{ roles-speechkit-tts }}`. Другие варианты аутентификации см. в разделе [{#T}](../../concepts/auth.md).

{% list tabs group=programming_language %}

- cURL {#curl}

  Чтобы повторить пример, потребуется утилита [jq](https://github.com/jqlang/jq) для работы с файлами JSON.

  1. Создайте файл `tts_rest.json` с параметрами запроса:

      ```json
      {
        "text": "Привет! Я Яндекс Спичк+ит. Я могу превратить любой текст в речь. Теперь и в+ы - можете!",
        "model": "tts://<идентификатор_каталога>/bvss-v1/latest@<идентификатор_голоса>/?<идентификатор_модели>" 
      }
      ```

      Где:

      * `text` — синтезируемый текст;
      * `model` — дообученная модель, к которой вы обращаетесь.

  1. В терминале выполните запрос, указав IAM-токен и идентификатор каталога, который вы будете использовать для работы с {{ speechkit-name }}:

      ```bash
      export FOLDER_ID=<идентификатор_каталога>
      export IAM_TOKEN=<IAM-токен>

        --header "Authorization: Bearer $IAM_TOKEN" \
        --header "x-folder-id: $FOLDER_ID" \
        --data @tts_rest.json https://{{ api-host-sk-tts }}:443/tts/v3/utteranceSynthesis | \
        jq -r  '.result.audioChunk.data' | \
        while read chunk; do base64 -d <<< "$chunk" >> audio_my.wav; done
      ```

     Где:

     * `FOLDER_ID` — [идентификатор каталога](../../../resource-manager/operations/folder/get-id.md), на который у вашего аккаунта есть роль `{{ roles-speechkit-tts }}` или выше. Если вы используете сервисный аккаунт, передавать в запросе идентификатор каталога не нужно.
     * `IAM_TOKEN` — IAM-токен вашего аккаунта на Яндексе или федеративного аккаунта.

     Синтезированная речь вернется в кодировке Base64 и будет записана в файл `audio_my.wav`.

{% endlist %}